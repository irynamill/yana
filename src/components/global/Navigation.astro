---
// Assets
import Logo from "@/components/assets/Logo.astro";
// Fundations
import Text from "@/components/fundations/elements/Text.astro";
import Button from "@/components/fundations/elements/Button.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";

const lang = Astro.url.searchParams.get("lang") ?? "en";
const withLang = (href) => `${href}?lang=${lang}`;
const translations = {
  en: { sugaring: "Get Sugared", courses: "Learn Sugaring" },
  de: { sugaring: "Sugaring buchen", courses: "Sugaring lernen" },
  ru: { sugaring: "Записаться", courses: "Обучение шугарингу" },
  ua: { sugaring: "Записатися", courses: "Навчання шугарингу" },
};
const navText = translations[lang] ?? translations.en;
const links = [
  { href: "/sugaring", text: navText.sugaring },
  { href: "/courses", text: navText.courses },
];
---

<nav class="fixed top-0 z-10 w-full bg-transparent">
  <Wrapper variant="standard" class="py-7">
    <div class="relative flex items-center justify-center">
      <a
        href={`/?lang=${lang}`}
        class="absolute left-0 top-1/2 -translate-y-1/2 flex"
      >
        <Logo
          class="text-base-600 dark:text-base-300 text-xs uppercase tracking-[5px] font-bold"
        />
      </a>
      <div class="hidden lg:flex items-center gap-10">
        {
          links.map((link) => (
            <a
              href={withLang(link.href)}
              class="text-base-600 dark:text-base-300 text-xs uppercase tracking-[4px] font-bold border-b-2 border-transparent pb-1 transition-colors duration-300 hover:border-base-600 dark:hover:border-base-300"
            >
              {link.text}
            </a>
          ))
        }
      </div>
      <div class="absolute right-0 top-1/2 -translate-y-1/2 flex items-center gap-4">
        <details class="relative">
          <summary class="list-none text-[10px] uppercase tracking-[3px] text-base-600 dark:text-base-300">
            {lang.toUpperCase()}
          </summary>
          <div class="absolute right-0 top-full mt-2 w-16 rounded-md border border-base-200 bg-white text-[10px] uppercase tracking-[3px] text-base-700 shadow-sm dark:border-base-800 dark:bg-base-950 dark:text-base-200">
            <a class="block px-3 py-2 hover:text-base-900 dark:hover:text-white" href={`${Astro.url.pathname}?lang=de`}>DE</a>
            <a class="block px-3 py-2 hover:text-base-900 dark:hover:text-white" href={`${Astro.url.pathname}?lang=en`}>EN</a>
            <a class="block px-3 py-2 hover:text-base-900 dark:hover:text-white" href={`${Astro.url.pathname}?lang=ru`}>RU</a>
            <a class="block px-3 py-2 hover:text-base-900 dark:hover:text-white" href={`${Astro.url.pathname}?lang=ua`}>UA</a>
          </div>
        </details>
        <button
          class="flex flex-col items-end gap-1 text-base-600 dark:text-base-300"
          type="button"
          aria-label="Open menu"
          data-menu-toggle
        >
          <span class="block h-[2px] w-6 bg-current"></span>
          <span class="block h-[2px] w-4 bg-current"></span>
        </button>
      </div>
    </div>
  </Wrapper>
  <div
    class="pointer-events-none fixed inset-0 z-20 flex items-center justify-center bg-base-50/95 opacity-0 transition-opacity duration-300 dark:bg-base-950/95"
    data-menu-overlay
  >
    <div class="text-center">
      <div class="flex flex-col gap-6">
        {
          links.map((link) => (
            <a
              href={withLang(link.href)}
              class="text-base-700 dark:text-base-200 text-lg uppercase tracking-[6px] font-bold"
            >
              {link.text}
            </a>
          ))
        }
      </div>
      <button
        type="button"
        class="mt-10 text-base-600 dark:text-base-300 text-xs uppercase tracking-[4px] font-bold"
        data-menu-close
      >
        Close
      </button>
    </div>
  </div>
</nav>

<script>
  const toggle = document.querySelector("[data-menu-toggle]");
  const close = document.querySelector("[data-menu-close]");
  const overlay = document.querySelector("[data-menu-overlay]");

  const openMenu = () => {
    overlay?.classList.remove("opacity-0", "pointer-events-none");
    overlay?.classList.add("opacity-100", "pointer-events-auto");
  };

  const closeMenu = () => {
    overlay?.classList.add("opacity-0", "pointer-events-none");
    overlay?.classList.remove("opacity-100", "pointer-events-auto");
  };

  toggle?.addEventListener("click", openMenu);
  close?.addEventListener("click", closeMenu);
  overlay?.addEventListener("click", (event) => {
    if (event.target === overlay) closeMenu();
  });

</script>
